# 问卷管理

## 1. 数据库设计

>使用 MongoDB 数据库。

表清单：

| 表名     | 描述 |
| -------- | ---- |
| Paper    | 问卷 |
| Question | 问题 |
| Option   | 选项 |

表关系：

```text
                  self-referencing
                     |-----|
           1:n       ↓     |      1:n
Paper ------------> Question ------------> Option
```

### 1.1. Paper （问卷）

| 字段  | 类型   | 约束        | 描述       |
| ----- | ------ | ----------- | ---------- |
| id    | String | required    | 主键。UUID |
| code  | String | required    | 编码       |
| name  | String | required    | 名称       |
| title | String | required    | 标题       |
| aside | String |             | 附加文字   |
| desc  | String | default: '' | 描述       |

### 1.2. Question （问题）

| 字段     | 类型   | 约束                 | 描述               |
| -------- | ------ | -------------------- | ------------------ |
| id       | String | required             | 主键。UUID         |
| parentId | String |                      | 父 ID              |
| paperId  | String |                      | 试卷 ID。外键      |
| category | Number | required             | 类别               |
| code     | String | required             | 编码               |
| content  | String | required             | 内容               |
| input    | String |                      | 被调查者填写的内容 |
| answer   |        |                      | 标准答案           |
| sort     | Number | required, default: 1 | 排序（权重）       |

### 1.3. Option （选项）

| 字段     | 类型   | 约束     | 描述       |
| -------- | ------ | -------- | ---------- |
| id       | String | required | 主键。UUID |
| questionId | String |  | 问题 ID。外键 |
| category | Number | required | 类别       |
| code | String | required    | 编码。如 `A`, ` B` |
| content  | String | required | 内容       |
| input | String |  | 被调查者填写的内容 |
| index    | Number | required | 索引       |

### 1.4. 值域（字典）

问题类别（Question.category）：

| 值   | 类型 | 说明 |
| ---- | ------ | ---- |
| `1`  | Number | 单选 |
| `2`  | Number | 多选 |
| `3`  | Number | 问答。无选项 |
| `4`  | Number | 排序 |
| `5`  | Number | 分组 |

选项类别（Option.category）：

| 值   | 类型 | 说明 | 示例 |
| ---- | ------ | ---- | - |
| `1`  | Number | 普通 | `A. 是` |
| `2`  | Number | 多选 | `E. 其他：___` |

## 2. 示例

针对各种题目，给出数据库表存储的数据情况。

### 2.1. 单选

示例：

```text
1. 您是否知道我公司的主动配送销售：

   A. 是    B. 否
```

Question 表：

|  id  | category | content                                 | answer  | paperId |
| ---- | -------- | --------------------------------------- | ------- | ---- |
| `q-1` | `1`      | `"1. 您是否知道我公司的主动配送销售："` | `["A"]` | `p-1` |

Option 表：

|  id  | category | code  | content   | index | questionId |
| ---- | -------- | ----- | --------- | ----- | ---- |
| `o-1-1` | `1`      | `"A"` | `"A. 是"` | `0`   | `q-1` |
| `o-1-2` | `1`      | `"B"` | `"B. 否"` | `1`   | `q-1` |

### 2.2. 多选

示例：

```text
2. 您是通过什么渠道了解主动配送销售的：（可复选）

   A. 宣传单    B. 朋友   C. 客户经理    D. 媒体    E. 其它：___
```

Question 表：

| id    | category | content                                               | answer | paperId |
| ----- | -------- | ----------------------------------------------------- | ------ | ------- |
| `q-2` | `2`      | `"2. 您是通过什么渠道了解主动配送销售的：（可复选）"` |        | `p-1`   |

Option 表：

| category | code  | content               | index | input          | questionId |
| -------- | ----- | --------------------- | ----- | -------------- | ----- |
| `1`      | `"A"` | `"A. 宣传单"`         | `0`   |                | `q-2` |
| `1`      | `"B"` | `"B. 朋友"`           | `1`   |                | `q-2` |
| `1`      | `"C"` | `"C. 客户经理"`       | `2`   |                | `q-2` |
| `1`      | `"D"` | `"D. 媒体"`           | `3`   |                | `q-2` |
| `2`      | `"E"` | `"E. 其它：${input}"` | `4`   | `"填写的内容"` | `q-2` |

### 2.3. 问答

示例：

```text
1. 您觉得我们的服务有哪些地方需要改进的：

   ______________________________________________________
   ______________________________________________________
```

Question 表：

|  id  | category | content                                       | answer |
| ---- | -------- | --------------------------------------------- | ------ |
| `q-3` | `3`      | `"3. 您觉得我们的服务有哪些地方需要改进的："` |        |

### 2.4. 排序

示例：

```text
1. 在您采购油品过程中，影响您决定供货方的因素，按重要性排序：___

   A. 售价格    B. 油品数质量    C. 服务质量    D. 其它：___
```

Question 表：

| category | content                                                      | answer | input    |
| -------- | ------------------------------------------------------------ | ------ | -------- |
| `4`      | `"4. 在您采购油品过程中，影响您决定供货方的因素，按重要性排序：${input}"` |        | `"cabd"` |

Option 表：

| category | code  | content       | index | input |
| -------- | ----- | ------------- | ----- | ----- |
| `1`      | `"A"` | `"A. 售价格"` | `0`   |       |
| `1`      | `"B"` | `"B. 油品数质量"` | `1`   |       |
| `1`      | `"C"` | `"C. 服务质量"` | `2`   |       |
| `2`      | `"D"` | `"D. 其它：${input}"` | `3`   | `"填写的内容"` |

### 2.5. 分组

示例：

```text
1. 采购油品的主要渠道是：

（1）汽油：（可复选）

    A. 中石油    B. 中石化   C. 社会单位

（2）柴油：（可复选）

    A. 中石油    B. 中石化   C. 社会单位
```

Question 表：

| id | category | content                   | answer | parentId |
| -- | -------- | ------------------------- | ------ | -------- |
| `q-5` | `5`      | `"5. 采购油品的主要渠道是："` |        |  |
| `q-5-1` | `2`      | `"（1）汽油：（可复选）"` |        | `q-5` |
| `q-5-2` | `2` | `"（2）柴油：（可复选）"` | | `q-5` |

Option 表：

| category | code  | content               | index | questionId     |
| -------- | ----- | --------------------- | ----- | -------------- |
| `1`      | `"A"` | `"A. 中石油"`         | `0`   | `q-5-1`        |
| `1`      | `"B"` | `"B. 中石化"`         | `1`   | `q-5-1`        |
| `1`      | `"C"` | `"C. 社会单位"`       | `2`   | `q-5-1`        |
| `1`      | `"A"` | `"A. 中石油"`         | `3`   | `q-5-2`        |
| `1`      | `"B"` | `"B. 中石化"`         | `4`   | `q-5-2`        |
| `1`      | `"C"` | `"C. 社会单位"`       | `5`   | `q-5-2`        |

## 3. 参考

* [两列自适应布局方案整理](https://segmentfault.com/a/1190000004424442)